# -*- coding: utf-8 -*-
"""Project BE.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1IwKJcn-TDjjS7bQAwA6dkMCCR_AtU32Q
"""

import tensorflow as tf
import numpy as np
import pandas as pd
import os
from tensorflow import keras
from tensorflow.keras.layers import Dense, Conv2D, Flatten, Dropout, MaxPooling2D

os.chdir("D:\Datasets\deepsat-sat6")

x_train = pd.read_csv(tf.gfile.Open('X_train_sat6.csv'), header = None)
y_train = pd.read_csv(tf.gfile.Open('Y_train_sat6.csv'), header = None)
x_train = x_train.values.reshape(x_train.shape[0],28,28,4).astype(np.float32)
y_train = y_train.values.astype(np.float32)

x_eval = pd.read_csv(tf.gfile.Open('X_test_sat6.csv'), header = None)
y_eval = pd.read_csv(tf.gfile.Open('Y_test_sat6.csv'), header = None)
x_eval = x_eval.values.reshape(x_eval.shape[0],28,28,4).astype(np.float32)
y_eval = y_eval.values.astype(np.float32)

model = keras.Sequential([
    Conv2D(16, 3, padding = 'same', activation = 'relu', input_shape=(28,28,4)),
    Conv2D(32, 3, padding = 'same', activation = 'relu'),
    MaxPooling2D(),
    Dropout(0.5),
    Conv2D(32, 3, padding = 'same', activation = 'relu'),
    MaxPooling2D(),
    Conv2D(64, 3, padding = 'same', activation = 'relu'),
    MaxPooling2D(),
    Dropout(0.5),
    Flatten(),
    Dense(512, activation = 'relu'),
    Dropout(0.5),
    Dense(6,activation = 'softmax')

])

model.compile(loss = 'categorical_crossentropy', optimizer = 'adam', metrics = ['accuracy'])

print(model.summary())

tensorboard_cb = TensorBoard(log_dir = './Graph/', histogram_freq = 1, write_graph = True, write_grads = True)
model.fit(x_train, y_train, batch_size = 512, epoch = 4, verbose = 1, validation_data(x_eval,y_eval), callbacks = [tensorboard_cb])